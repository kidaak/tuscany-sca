<?xml version="1.0" encoding="UTF-8"?>
<!--
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->
<project name="OpenAjaxZipInstaller">

    <property name="openajax.version" value="1.0_build117_v1.0"/>
    <property name="unpack.location" value="${basedir}/openajax"/>
	
    <target name="check-openajax-installed">
        <condition property="already.installed" >
            <available file="${localRepository}/openajax/openajax/${openajax.version}/openajax-${openajax.version}.zip"/>
        </condition>
        <condition property="maven.suffix" value="">
            <os family="unix"/>
        </condition>
        <condition property="maven.suffix" value=".bat">
            <os family="windows"/>
        </condition>
    </target>
	

    <target name="check-openajax-unpacked">
        <condition property="already.unpacked" >
            <available file="${unpack.location}"/>
        </condition>
    </target>

    <target name="install-openajax" depends="check-openajax-installed" unless="already.installed">
        <mkdir dir="${basedir}/target/openajax-download/"/>
        <get src="http://downloads.sourceforge.net/openajaxallianc/OpenAjaxHub${openajax.version}.zip"
            dest="${basedir}/target/openajax-download/openajax-${openajax.version}.zip"
            verbose="true"
            usetimestamp="true"/>
        <exec executable="mvn${maven.suffix}" dir="${basedir}" failonerror="false">
            <arg line="install:install-file -DgroupId=openajax  -DartifactId=openajax -Dversion=${openajax.version} -Dpackaging=zip -DgeneratePom=true -Dfile=${basedir}/target/openajax-download/openajax-${openajax.version}.zip"/>
        </exec>
    </target>

    <target name="install-openajax-nomaven" depends="check-openajax-installed" unless="already.installed">
        <mkdir dir="${basedir}/target/openajax-download/"/>
        <get src="http://downloads.sourceforge.net/openajaxallianc/OpenAjaxHub${openajax.version}.zip"
            dest="${basedir}/target/openajax-download/openajax-${openajax.version}.zip"
            verbose="true"
            usetimestamp="true"/>
        <copy file="${basedir}/target/openajax-download/openajax-${openajax.version}.zip" 
              tofile="${localRepository}/openajax/openajax/${openajax.version}/openajax-${openajax.version}.zip"/>
    </target>
	

    <target name="unpack-openajax-files" depends="check-openajax-installed, check-openajax-unpacked" unless="already.unpacked">
        <fail message="openajax zip file not installed in local repository: ${localRepository}" unless="already.installed"/>
        <mkdir dir="${basedir}/target/openajax-unpack-temp/"/>
        <unzip src="${localRepository}/openajax/openajax/${openajax.version}/openajax-${openajax.version}.zip"
               dest="${basedir}/target/openajax-unpack-temp/"
               overwrite="false">
            <patternset>
                <include name="OpenAjaxHub${openajax.version}/release/**"/>
            </patternset>
        </unzip>
        <move file="${basedir}/target/openajax-unpack-temp/OpenAjaxHub${openajax.version}/release"
              tofile="${unpack.location}"
              verbose="true"/>
        <delete dir="${basedir}/target/openajax-unpack-temp/"/>
    </target>
	

    <target name="clean-openajax-files">
        <delete dir="${unpack.location}"/>
    </target>
</project>
